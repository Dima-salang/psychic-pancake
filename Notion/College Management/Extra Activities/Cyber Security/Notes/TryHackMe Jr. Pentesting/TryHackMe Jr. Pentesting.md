# Penetration Testing

- a penetration test or pentest is an ethically-driven attempt to test and analyse the security defences to protect assets and important pieces of information.
- is an authorized audit of a computer system’s security and defenses as agreed by the owner of the systems.

|   |   |   |
|---|---|---|
|**Hat Category**|**Description**|**Example**|
|White Hat|These hackers are considered the "good people". They remain within the law and use their skills to benefit others.|For example, a penetration tester performing an authorised engagement on a company.|
|Grey Hat|These people use their skills to benefit others often; however, they do not respect/follow the law or ethical standards at all times.|For example, someone taking down a scamming site.|
|Black Hat|These people  are criminals and often seek to damage organisations or gain some form of financial benefit at the cost of others.|For example, ransomware authors infect devices with malicious code and hold data for ransom.|

**Rules of Engagement (ROE)**

The ROE is a document that is created at the initial stages of a penetration testing engagement. This document consists of three main sections (explained in the table below), which are ultimately responsible for deciding how the engagement is carried out.

|   |   |
|---|---|
|**Section**|**Description**|
|Permission|This section of the document gives explicit permission for the engagement to be carried out. This permission is essential to legally protect individuals and organisations for the activities they carry out.|
|Test Scope|This section of the document will annotate specific targets to which the engagement should apply. For example, the penetration test may only apply to certain servers or applications but not the entire network.|
|Rules|The rules section will define exactly the techniques that are permitted during the engagement. For example, the rules may specifically state that techniques such as phishing attacks are prohibited, but MITM (Man-in-the-Middle) attacks are okay.|

  

# Pentesting Methodologies

|   |   |
|---|---|
|**Stage**|**Description**|
|Information Gathering|This stage involves collecting as much publically accessible information about a target/organisation as possible, for example, OSINT and research.  <br>**Note:** This does not involve scanning any systems.|
|Enumeration/Scanning|This stage involves discovering applications and services running on the systems. For example, finding a web server that may be potentially vulnerable.|
|Exploitation|This stage involves leveraging vulnerabilities discovered on a system or application. This stage can involve the use of public exploits or exploiting application logic.|
|Privilege Escalation|Once you have successfully exploited a system or application (known as a foothold), this stage is the attempt to expand your access to a system. You can escalate horizontally and vertically, where horizontally is accessing another account of the same permission group (i.e. another user), whereas vertically is that of another permission group (i.e. an administrator).|
|Post-exploitation|This stage involves a few sub-stages:  <br>  <br>**1.** What other hosts can be targeted (pivoting)  <br>**2.** What additional information can we gather from the host now that we are a privileged user  <br>**3.**  Covering your tracks  <br>**4.** Reporting|

# **OSSTMM**

[The Open Source Security Testing Methodology Manual](https://www.isecom.org/OSSTMM.3.pdf) provides a detailed framework of testing strategies for systems, software, applications, communications and the human aspect of cybersecurity.

The methodology focuses primarily on how these systems, applications communicate, so it includes a methodology for:

1. **Telecommunications (phones, VoIP, etc.)**
2. Wired Networks
3. Wireless communications

# **OWASP**

[![](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/497e56c5522ca4932d720ae5fae32845.png)](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/497e56c5522ca4932d720ae5fae32845.png)

The "[Open Web Application Security Project](https://owasp.org/)" framework is a community-driven and frequently updated framework used solely to test the security of web applications and services.

The foundation regularly [writes reports](https://owasp.org/www-project-top-ten/2017/) stating the top ten security vulnerabilities a web application may have, the testing approach, and remediation.

|   |   |
|---|---|
|**Advantages**|**Disadvantages**|
|Easy to pick up and understand.|It may not be clear what type of vulnerability a web application has (they can often overlap).|
|Actively maintained and is frequently updated.|OWASP does not make suggestions to any specific software development life cycles.|
|It covers all stages of an engagement: from testing to reporting and remediation.|The framework doesn't hold any accreditation such as CHECK.|
|Specialises in web applications and services.|_Intentionally left blank._|

# **NIST Cybersecurity Framework 1.1**

[![](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/8e11f5fcfc8fc6429fe35682797e2a24.jpg)](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/8e11f5fcfc8fc6429fe35682797e2a24.jpg)

The [NIST Cybersecurity Framework](https://www.nist.gov/cyberframework) is a popular framework used to improve an organisations cybersecurity standards and manage the risk of cyber threats. This framework is a bit of an honourable mention because of its popularity and detail.

The framework provides guidelines on security controls & benchmarks for success for organisations from critical infrastructure (power plants, etc.) all through to commercial.  There is a limited section on a standard guideline for the methodology a penetration tester should take.

  

  

# Black, Gray, and White Pentesting

![[/Untitled 7.png|Untitled 7.png]]

  

Black-box testing

- is a high-level process where the tester is not given any information about the inner workings of the application or service.

  

Gray-Box testing

This testing process is the most popular for things such as penetration testing. It is a combination of both black-box and white-box testing processes.The tester will have some **limited** knowledge of the internal components of the application or piece of software. Still, it will be interacting with the application as if it were a black-box scenario and then using their knowledge of the application to try and resolve issues as they find them.

With Grey-Box testing, the limited knowledge given saves time, and is often chosen for extremely well-hardened attack surfaces.

  

# White-Box Testing

This testing process is a low-level process usually done by a software developer who knows programming and application logic. The tester will be testing the internal components of the application or piece of software and, for example, ensuring that specific functions work correctly and within a reasonable amount of time.

The tester will have **full** knowledge of the application and its expected behaviour and is much more time consuming than black-box testing. The full knowledge in a White-Box testing scenario provides a testing approach that guarantees the entire attack surface can be validated.

  

  

# Web Hacking

  

Sometimes you can find out more about the web application using manual operations such as in-built browser tools such as the inspector, network analyzer, viewing the page source.

  

## Subdomain Enumeration

- is the process of identifying all subdomains for a given domain
    - for identifying potential targets of an attack or simply for organization purposes
    - to gain insights into the organization such as how it is structured, what services they offer, and so on. Valuable for reconnaissance
    - to find misconfigured DNS entries: in some cases, organizations may have misconfigured DNS entries that reveal sensitive information, such as internal IP addresses.
- How to perform?
    - Passive subdomain enumeration
        - performed using publicly available data
            - Certificate transparency
                - any SSL/TLS certificate that is issued by a CA, that participates in CT will be logged to one or more public Certificate Transparency Logs
                - [https://crt.sh/](https://crt.sh)
            - Google Dorking
                - site:
                - advanced operators
            - DNS aggregators
                - are services that allow you to check multiple DNS servers at once to see if they’re configured correctly.
                - [https://dnsdumpster.com](https://dnsdumpster.com/)
            - ASN Enumeration
            - Subject Alternate Name
    - Active subdomain enumeration
        - interacts with the target domain directly. This is achieved by sending various types of requests, such as web requests and DNS queries.
        - Brute force enumeration
        - Zone transfer
        - DNS records
        - Content Security Policy Header

  

## Authentication Bypass Vulnerability

- authentication is the process of attempting to verify the digital identity of the sender of a communication.
- is a weak point in the user authentication process. A threat actor exploiting such a weakness circumvents authentication altogether to gain access.
- Several methods to bypass authentication
    - Direct page request (forced browsing)
        - If a web application implements access control only on the log in page, the authentication schema could be bypassed. For example, if a user directly requests a different page via forced browsing, that page may not check the credentials of the user before granting access. Attempt to directly access a protected page through the address bar in your browser to test using this method.
    - Parameter modification
        - Another problem related to authentication design is when the application verifies a successful log in on the basis of a fixed value parameters. A user could modify these parameters to gain access to the protected areas without providing valid credentials.
    - Session ID prediction
        - Many web applications manage authentication by using session identifiers (session IDs). Therefore, if session ID generation is predictable, a malicious user could be able to find a valid session ID and gain unauthorized access to the application, impersonating a previously authenticated user.
    - SQL injection

  

## Insecure direct object references (IDOR)

- Access control is the application of constraints on who or what is authorized to perform actions or access resources. In the context of web apps, access control is dependent on authentication and session management.
    - Session management identifies which subsequent HTTP requests are being made by that same user.
- Vertical access controls
    - are mechanisms that restrict access to sensitive functionality to specific types of users
    - An admin might be able to modify or delete user accounts while an ordinary user has no access to these actions.
    - vertical access controls can be more fine-grained implementations of security models designed to enforce business policies such as separation of duties and least privilege.
- Horizontal access control
    - are mechanisms that restrict access to resources to specific users. different users have access to a subset of resources of the same type.
    - a banking app will allow a user to view their payments but not of others
- Context-dependent access control
    - restrict access to functionality and resources based upon the state of the application or the user’s interaction with it.
- Broken access controls
    - Vertical privilege escalation
        - if a user can gain access to functionality that they are not permitted to access.
        - at it’s most basic, it arises where an application does not enforce any protection for sensitive functionality.
    - Horizontal privilege escalation
        - occurs if a user is able to gain access to resources belonging to another user, instead of their own resources of that type.
- IDOR are a type of access control vulnerability that arises when an application uses user-supplied input to access object directly.IDOR vulnerabilities are most commonly associated with horizontal privilege escalation, but they can also arise in relation to vertical privilege escalation.
- **IDOR vulnerability with direct reference to database objects**
    
    Consider a website that uses the following URL to access the customer account page, by retrieving information from the back-end database:
    
    ```Plain
    https://insecure-website.com/customer_account?customer_number=132355
    ```
    
    Here, the customer number is used directly as a record index in queries that are performed on the back-end database. If no other controls are in place, an attacker can simply modify the `customer_number` value, bypassing access controls to view the records of other customers. This is an example of an IDOR vulnerability leading to horizontal privilege escalation.
    
    An attacker might be able to perform horizontal and vertical privilege escalation by altering the user to one with additional privileges while bypassing access controls.
    

### **How to prevent access control vulnerabilities**

Access control vulnerabilities can be prevented by taking a defense-in-depth approach and applying the following principles:

- Never rely on obfuscation alone for access control.
- Unless a resource is intended to be publicly accessible, deny access by default.
- Wherever possible, use a single application-wide mechanism for enforcing access controls.
- At the code level, make it mandatory for developers to declare the access that is allowed for each resource, and deny access by default.
- Thoroughly audit and test access controls to ensure they work as designed.

  

  

## File Inclusion

- is a type of web vulnerability that is most commonly found to affect web apps that rely on scripting run time. This issue is caused when an application builds a path to executable code using an attacker-controlled variable that allows the attacker to control which file is executed at run time.

This can lead to something as outputting the contents of the file, but depending on the severity, it can also lead to:

- Code execution on the web server
- Code execution on the client-side such as JavaScript which can lead to other attacks such as cross site scripting (XSS)
- Denial of Service (DoS)
- Sensitive Information Disclosure

Types

- Remote file inclusion
    - occurs when the web app downloads an executes a remote file. These remote files are usually obtained in the form of an HTTP or FTP URI as a user-supplied parameter to the web app
- Local file inclusion
    
    - allows an attacker to include a file, usually exploiting a “dynamic file inclusion” mechanisms. The vulnerability occurs due to the use of user-supplied input without proper validation.
    
    Local file inclusion (also known as LFI) is the process of including files, that are already locally present on the server, through the exploiting of vulnerable inclusion procedures implemented in the application. This vulnerability occurs, for example, when a page receives, as input, the path to the file that has to be included and this input is not properly sanitized, allowing directory traversal characters (such as dot-dot-slash) to be injected. Although most examples point to vulnerable PHP scripts, we should keep in mind that it is also common in other technologies such as JSP, ASP and others.
    
    Since LFI occurs when paths passed to `include` statements are not properly sanitized, in a blackbox testing approach, we should look for scripts which take filenames as parameters.
    
    Consider the following example:
    
    `http://vulnerable_host/preview.php?file=example.html`
    
    This looks as a perfect place to try for LFI. If an attacker is lucky enough, and instead of selecting the appropriate page from the array by its name, the script directly includes the input parameter, it is possible to include arbitrary files on the server.
    
    Typical proof-of-concept would be to load passwd file:
    
    `http://vulnerable_host/preview.php?file=../../../../etc/passwd`
    
    If the above mentioned conditions are met, an attacker would see something like the following:
    
    `root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin alex:x:500:500:alex:/home/alex:/bin/bash margo:x:501:501::/home/margo:/bin/bash ...`
    

  

  

## Server-Side Request Forgery (SSRF)

- it is an attack that involves an attacker abusing server functionality to access of modify resources. The attacker targets an application that supports data imports from URLs or allow them to read data from URLs.
- URLs can be manipulated, either by replacing them with new ones or by tamptering with URL path traversal.

  

Typically, attackers supply a URL (or modify an existing one) and the code running on the server reads or submits data to it. [Attackers](https://www.imperva.com/learn/application-security/ethical-hacking/) can leverage URLs to gain [access](https://www.imperva.com/learn/application-security/broken-object-level-authorization-bola/) to internal data and services that were not meant to be exposed – including HTTP-enabled databases and server configuration data.

Once an attacker has tampered with the request, the server receives it and attempts to read data to the altered URL. Even for services that aren’t exposed directly on the public internet, attackers can select a target URL, which enables them to read the data.

- Risks
    - Data Exposure  
          
          
        `http://169.254.169.254/latest/meta-data/iam/security-credentials/{role-name}`
    - Reconnaissance
        - a common security practice used to minimize the attack surface from external networks is to limit the use of public-facing servers. The remaining servers are reserved for internal communication.
        - SSRF allows attackers to carry out scans and collect information about internal networks.
    - Port Scans or Cross Site Port Attacks (XSPA)
        - SSRF don’t always return data to the attacker. Response time or other metadata, however, can allow an attacker to determine if a request was a success or not. If a port and a host can be pinpointed, the attacker could port scan the application server’s network
    - Denial of Service (DoS)
        - the volume of requests received by the internal servers is typically lower than the traffic to public-facing servers. Thus, they are configured to incur lower bandwidth.
        - threat actors can utilize SSRF to flood the internal servers with large amounts of traffic to take up their bandwidth, which results in an internal DoS attack
    - Remote Code Execution (RCE)
- Types of SSRF attacks
    
    - Server SSRF Attacks
        
        - attackers exploit a process in which a browser or other client system directly accesses a URL on the server.
        - The attacker will replace the original URL with another, typically using the IP 127.0.0.1 or the hostname “localhost”, which point to the local file system on the server. Under this hostname the attacker finds a file path that leads to [sensitive data](https://www.imperva.com/learn/data-security/sensitive-data/).
        
        ![[/Untitled 1 2.png|Untitled 1 2.png]]
        
    
    ```Plain
    POST /meteorology/forecasts HTTP/1.0
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 113
    weatherApi=http://data.weatherapp.com:8080/meterology/forecasts/check%3FcurrentDateTime%3D6%26cityId%3D1
    The attacker can change this to the following:
    weatherApi=http://localhost/admin
    ```
    
    This will cause the server to display the contents of the /admin folder to the attacker. Because the request is executed within the server’s file system, it bypasses ordinary access controls and exposes the information even though the attacker is unauthorized.
    
    - Back-End SSRF Attacks
        - another variant on SSRF is when a server has a trusted relationship with a back-end component. If, when the server connects to that component, it has full access rights, an attacker can forge a request and gain access to sensitive data, or perform unauthorized d operations. Back-end components often have weak security because they are considered to be protected inside the network perimeter.
    
    Continuing the previous example, the attacker could replace the API call with:
    

```Plain
weatherApi=http://192.168.12.5/admin
```

If the server connects to a back-end component on IP address 192.168.12.5 and is allowed to access the /admin directory on that component’s file system, the attacker can similarly gain access and view the content of the directory.

- Mitigating SSRF
    - Whitelists and DNS resolution
    - Response handling
    - Disable unused URL schemas
    - authentication on internal services

  

  

## Cross Site Scripting (XSS)

- XSS attacks are a type of injection, in which malicious scripts are injected into otherwise benign and trusted websites.
- XSS attacks occur when an attacker uses a web application to send malicious code, generally in the form of a browser side script, to a different end user.
- Vulnerabilities that allow these attacked to succeed are quite widespread and occur anywhere a web app uses input from a user within the output it generates without validating or encoding it.
- An attacker can use XSS to send a malicious script to an unsuspecting user. The end user’s browser has no way to know that the script should not be trusted, and will execute the script.
- XSS attacks occur when
    - Data enters a web application through an untrusted source, most frequently a web request.
    - the data is included in dynamic content that is sent to a web use without being validated for malicious content.